<div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
    <div class="breadcrumb-title pe-3">Proformas</div>
    <div class="ps-3">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb mb-0 p-0">
          <li class="breadcrumb-item"><a href="#" (click)="$event.preventDefault()"><i class="bx bx-home-alt"></i></a>
          </li>
          <li class="breadcrumb-item active" aria-current="page">Crear Proformas</li>
        </ol>
      </nav>
    </div>
</div>
<form
class="row g-3 needs-validation"
[formGroup]="form"
(ngSubmit)="register(form.value)"
id="proforma"
novalidate
 >
 <div class="row mt-4 flex justify-content-center">
  <div class="col-md-12">
    <div class="card">
      <div class="card-body">
          <div class="row mt-3 mb-3 container">
           <div class="col-md-6">
              <div class="row">
                  <div class="col-md-10 form-group is-invalid">
                      <label for="nombre" class="form-label">Razon Social</label>
                      <input
                      type="text"
                      class="form-control form-control-sm"
                      id="razon_social"
                      formControlName="razon_social"
                      placeholder="Razon Social"
                      [ngClass]="{ 'is-invalid':
                      (form.controls.razon_social.touched ||
                      form.controls.razon_social.dirty)
                      && form.controls.razon_social.invalid }"
                      >
                      <!-- <app-input-validator-error
                      [control]="form.controls.nit"
                      [controlName]="'Nit'"></app-input-validator-error> -->
                  </div>

              </div>
              <div class="row mt-2">
                  <div class="col-md-5 form-group is-invalid">
                      <label for="nombre" class="form-label">Nit</label>
                      <input
                      type="text"
                      class="form-control form-control-sm"
                      id="nit"
                      formControlName="nit"
                      placeholder="Nit"
                      [ngClass]="{ 'is-invalid':
                      (form.controls.nit.touched ||
                      form.controls.nit.dirty)
                      && form.controls.nit.invalid }"
                      >
                      <!-- <app-input-validator-error
                      [control]="form.controls.nit"
                      [controlName]="'Nit'"></app-input-validator-error> -->
                  </div>
                  <div class="col-md-5 form-group is-invalid">
                    <label for="nombre" class="form-label">Telefono</label>
                    <input
                    type="text"
                    class="form-control form-control-sm"
                    id="nit"
                    formControlName="telefono"
                    placeholder="Telefono"
                    [ngClass]="{ 'is-invalid':
                    (form.controls.telefono.touched ||
                    form.controls.telefono.dirty)
                    && form.controls.telefono.invalid }"
                    >
                    <!-- <app-input-validator-error
                    [control]="form.controls.nit"
                    [controlName]="'Nit'"></app-input-validator-error> -->
                </div>
                <div class="col-md-10 mt-2 form-group is-invalid">
                  <label for="nombre" class="form-label">Direccion</label>
                  <input
                  type="text"
                  class="form-control form-control-sm"
                  id="nit"
                  formControlName="direccion"
                  placeholder="Direccion"
                  [ngClass]="{ 'is-invalid':
                  (form.controls.direccion.touched ||
                  form.controls.direccion.dirty)
                  && form.controls.direccion.invalid }"
                  >
              </div>
                  <div class="col-md-10 mt-2">
                    <label for="nombre" class="form-label">Moneda</label>
                    <ng-select
                           #id{{i}}
                           [items]="array"
                           formControlName="dolar"
                           class="form-select single-select"
                           bindLabel="tipo_moneda"
                           bindValue="valor"
                           class="custom"
                           disabled
                           (change)="onMoneda($event)"
                         >
                         </ng-select>
                  </div>
                  <!-- <div class="col-md-5 form-group is-invalid mt-2">
                    <label for="nombre" class="form-label">Con/Sin Factura</label>
                    <input
                    type="checkbox"
                    formControlName="factura"
                    class="form-control form-control-sm form-check-input"
                    id="factura"
                    value=1
                    >
                </div> -->
              </div>
          </div>
          <div class="col-md-6">
             <div class="row">
              <div class="col-md-12 form-group">
                  <label class="form-label">Clientes</label>
                  <div class="input-group">
                      <ng-select
                          formControlName="cliente_id"
                          [items]="clientes"
                          bindLabel="razon_social"
                          bindValue="cliente_id"
                          (change)="onClienteSelect($event)"
                          style="width:100% ;"
                      >
                      </ng-select>

                  </div>
              </div>

              <div class="col-md-12 form-group is-invalid" *ngIf="user.roles[0].id==1">
                <label for="nombre" class="form-label">Ubicacion</label>
                  <ng-select
                      [items]="Sucursales"
                      bindLabel="nombre"
                      bindValue="sucursal_id"
                      style="width: 100% ;"
                      formControlName="sucursal_id"
                      (change)="OnSucursal($event)"
                  >
                  </ng-select>
              </div>
              <!-- <div class="col-md-12">
                <label class="form-label">Nuevo Cliente</label>
                <a
                 (click)="crearCliente()"
                class="btn btn-primary radius-30 mt-2 mt-lg-0"
                >
                  <i class="bx bxs-plus-square"></i>Nuevo Cliente
                </a>
                <app-crear-clientes (clienteEvent)="showItem($event)"></app-crear-clientes>
              </div>         -->
          </div>

          </div>
          </div>
      </div>
  </div>
  </div>

  <div class="col-md-12">
    <div class="card">
      <div class="card-body">
        <div class="mt-4 mb-5">
          <div>
           <h5>PRODUCTOS</h5>
           <hr>
          </div>
             <div class="table-responsive">
               <table class="table table-borderless mb-0">
                 <thead>
                   <tr>
                     <th style="width:20px;">#</th>
                     <th style="width: 350px;">Medicamento</th>
                     <th>Concentracion</th>
                     <th style="width: 80px;">Stock</th>
                     <th style="width: 80px;">Cant.</th>
                     <th>Precio</th>
                     <th>Sub Total</th>
                     <th>
                       <!-- Acciones -->
                       <div class="d-flex order-actions ">
                         <a (click)="sumarUno();" class="bg-color-blue text-white"><i class='bx bx-list-plus'></i></a>
                       </div>
                     </th>
                   </tr>
                 </thead>
                 <tbody>
                   <tr *ngFor="let basic of detalle.controls; let i = index">
                       <td style="width: 20px " >{{i+1}}</td>
                       <td class="">
                        <ng-select
                          #producto_id{{i}}
                          [items]="productos"
                          bindLabel="texto"
                          bindValue="producto_id"
                          [formControl]="basic.get('producto_id')"
                          (change)="onProductoSelect($event,i); onCantidad($event,i);"
                          style="width: 350px ;"
                          disabled
                        >
                        </ng-select>
                     </td>
                     <td class="text-center">
                          {{basic.get('concentracion').value}}
                        <!-- <div class="d-flex order-actions justify-content-center">
                          <a *ngIf="basic.get('stock').value==0" class="text-warning p-1 px-1 ms-3">
                            <i class='icon me-1'title="El stock no es suficiente"></i>
                          </a>
                          <a *ngIf="basic.get('stock').value>0" class="text-success p-1 px-1n ms-3">
                            <i class='icon-success me-1'></i>
                          </a>
                        </div> -->
                     </td>
                     <td class="d-flex justify-content-center ">
                      <input
                      type="text"
                      class="form-control form-control-sm"
                      id="total"
                      disabled="true"
                      [value]="basic.get('stock').value"
                      style="width: 80px;"
                      >

                     </td>
                       <td class="">
                          <input
                          type="number"
                          class="form-control form-control-sm"
                          [formControl]="basic.get('cantidad')"
                          (change)="onCantidad($event,i)"
                          min="1"
                          style="width: 80px;"
                          >
                       </td>
                       <td style="width: 200px;">
                           <input
                           type="number"
                           class="form-control form-control-sm"
                           [formControl]="basic.get('precio')"
                           (change)="onCantidad($event,i)"
                           >
                           <!-- {{ basic.get('precio').value | currency: 'BOB':'symbol-narrow':'1.2-2' }} -->
                       </td>
                       <td style="width: 200px;">
                         <input
                           type="text"
                           class="form-control form-control-sm"
                           [value]="basic.get('total').value| number: '1.2'"
                           disabled="true"
                           >
                           <!-- {{ basic.get('total').value | currency: 'BOB':'symbol-narrow':'1.2-2' }} -->
                       </td>
                       <td>
                           <div class="d-flex order-actions">
                               <a (click)="restarUno(i)" class="bg-color-yellow text-white"><i class='bx bx-minus'></i></a>
                             </div>
                       </td>
                   </tr>
                 </tbody>
                  <tfoot>
                    <tr *ngIf="form.get('dolar').value==0">
                      <td colspan="5"></td>
                      <td colspan="2" class="d-flex justify-content-end " >TOTAL</td>
                      <td>
                        <input
                        type="text"
                        class="form-control form-control-sm"
                        id="total"
                        disabled="true"
                        [value]="total| number: '1.2'"
                        >
                      </td>
                    </tr>
                    <tr *ngIf="form.get('dolar').value==1">
                      <td colspan="5"></td>
                      <td colspan="2" class="d-flex justify-content-end " >TOTAL</td>
                      <td>
                        <input
                        type="text"
                        class="form-control form-control-sm"
                        id="total"
                        disabled="true"
                        [value]="totalDolar| number: '1.2'"
                        >
                      </td>
                    </tr>
                    <!-- <tr *ngIf="form.get('tipo').value == 1">
                      <td colspan="5"></td>
                       <td class="d-flex justify-content-end ">INTERES({{form.get('interes').value}} %)</td>
                       <td *ngIf="form.get('dolar').value==0">
                        <input
                        type="text"
                        class="form-control form-control-sm"
                        id="total"
                        disabled="true"
                        [value]="total*form.get('interes').value/100 | number: '1.2'"
                        >
                       </td>
                       <td *ngIf="form.get('dolar').value==1">
                        <input
                        type="text"
                        class="form-control form-control-sm"
                        id="total"
                        disabled="true"
                        [value]="totalDolar*form.get('interes').value/100 | number: '1.2'"
                        >
                       </td>
                    </tr> -->
                    <!-- <tr *ngIf="form.get('factura').value">
                      <td colspan="5"></td>
                      <td class="d-flex justify-content-end ">IVA({{factura*100}} %)</td>
                      <td *ngIf="form.get('dolar').value==0">
                        <input
                        type="text"
                        class="form-control form-control-sm"
                        id="total"
                        disabled="true"
                        [value]="total*factura | number: '1.2'"
                        >
                      </td>
                      <td *ngIf="form.get('dolar').value==1">
                        <input
                        type="text"
                        class="form-control form-control-sm"
                        id="total"
                        disabled="true"
                        [value]="totalDolar*factura | number: '1.2'"
                        >
                      </td>
                   </tr> -->
                   <tr *ngIf="form.get('dolar').value==0">
                    <td colspan="5"></td>
                    <td class="d-flex justify-content-end ">TOTAL BS.</td>
                    <td>
                      <input
                      type="text"
                      class="form-control form-control-sm"
                      id="total"
                      disabled="true"
                      [value]="form.get('total').value | number: '1.2'"
                      [ngClass]="{ 'is-invalid':
                      (form.controls.total.touched ||
                      form.controls.total.dirty)
                      && form.controls.total.invalid }"
                      >
                    </td>
                   </tr>
                   <tr *ngIf="form.get('dolar').value==1">
                    <td colspan="5"></td>
                    <td class="d-flex justify-content-end ">TOTAL $US.</td>
                    <td>
                      <input
                      type="text"
                      class="form-control form-control-sm"
                      id="total"
                      disabled="true"
                      [value]="form.get('total$US').value | number:'1.2'"
                      [ngClass]="{ 'is-invalid':
                      (form.controls.total.touched ||
                      form.controls.total.dirty)
                      && form.controls.total.invalid }"

                      >
                    </td>
                   </tr>
                  </tfoot>

               </table>
             </div>
       </div>
      </div>
    </div>
  </div>
 </div>
 <div class="row mt-1 flex justify-content-center">
  <div class="col-md-2">
      <button
        type="button"
        class="btn btn-danger btn-lg"
        [routerLink]="['/dashboard/proformas/list-proformas']"
      >Cancelar</button>
         &nbsp;
  </div>
  <div class="col-md-3">
      <button
        type="submit"
        class="btn bg-color-blue btn-lg"
        [disabled]="form.invalid || isLoading"
      >

        <i class="lni lni-save" *ngIf="!isLoading"></i>
        <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true" *ngIf="isLoading"></span>
        Guardar
      </button>
  </div>
  <div class="col-md-3" *ngIf=" proforma_id!=null">
    <button
      type="button"
      class="btn bg-color-green btn-lg"
      (click)="openPdf(proforma_id)"
    >

      <i class="fa fa-file-pdf-o"></i>
      <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true" *ngIf="isLoading"></span>
      Ver PDF
    </button>
</div>
</div>
</form>
